import{qs,qsa,ce,GetById}from"./shortcuts.js";let isMobile=window.matchMedia("(max-width: 480px)"),isTablet=window.matchMedia("(min-width: 481px) and (max-width: 1024px)"),isDesktop=window.matchMedia("(min-width: 1025px)");function gestisciLayout(){isMobile.matches||isTablet.matches?createHamburgerMenu():isDesktop.matches}function createHamburgerMenu(){let d=qs(".left-header"),l=qs(".social-media"),r=qs("header");if(r.style.justifyContent="space-between",d.style.display="none",l.style.display="none",!GetById("hamburger-menu")){let o=ce("img");o.id="hamburger-menu",o.src="img/hamburger.png",o.style.width="2rem",o.style.cursor="pointer",r.appendChild(o),o.addEventListener("click",()=>{let t=ce("div"),e=(t.classList.add("body-overlay"),document.body.appendChild(t),ce("div"));e.classList.add("info-container"),l.style.display="flex",d.style.display="flex",e.appendChild(l),e.appendChild(d),document.body.appendChild(e);var a=GetById("portfolio-btns");a.classList.add("portfolio-btns"),a.querySelectorAll("a").forEach(e=>{e.addEventListener("click",n)});let i=ce("img");function n(){t.remove(),e.remove(),i.remove(),r.appendChild(o),d.style.display="none",l.style.display="none"}i.classList.add("close-button"),i.src="img/close.png",r.appendChild(i),o.remove(),i.addEventListener("click",n),t.addEventListener("click",e=>{e.target===t&&n()})})}}async function getProjects(){try{var e=await(await fetch("projects.json")).json(),t=(console.log(e),e.forEach(e=>project(e.title,e.description,e.image,e.technologies,e.liveDemo,e.repo)),e[5]);console.log(t)}catch(e){console.log(e)}}function project(e,t,a,i,o,d){var n=qs(".projects-container");n.classList.add("projects-container");let l=ce("div");l.classList.add("the-project"),n.appendChild(l);n=ce("h2"),n.textContent=e,l.appendChild(n),e=ce("img"),e.src=a,l.appendChild(e),n=ce("p"),n.classList.add("projects-description"),n.textContent=t,l.appendChild(n),a=ce("p"),a.classList.add("projects-technologies"),a.textContent="Tecnologie usate: "+i,l.appendChild(a),e=window.matchMedia("(max-width: 767px)").matches;if(e){t=ce("div"),n=(t.classList.add("mobile-buttons"),ce("button")),i=(n.classList.add("work-with-me-btn"),n.setAttribute("data-url",o),n.textContent="Vai Al Sito!",t.appendChild(n),ce("button"));function r(e){e=e.currentTarget.getAttribute("data-url");e&&window.open(e,"_blank")}i.classList.add("work-with-me-btn"),i.setAttribute("data-url",d),i.textContent="Repository",t.appendChild(i),l.appendChild(t),n.addEventListener("click",r),i.addEventListener("click",r)}else{let n=ce("div");n.classList.add("project-overlay"),l.appendChild(n),l.addEventListener("mouseover",()=>{function e(e){e=e.currentTarget.getAttribute("data-url");e&&window.open(e,"_blank")}var t,a,i;n.style.opacity="1",l.querySelector(".reference-container")||((t=ce("div")).classList.add("reference-container"),n.appendChild(t),(a=ce("button")).classList.add("projects-btns"),a.setAttribute("data-url",o),a.textContent="Vai Al Sito!",t.appendChild(a),(i=ce("button")).classList.add("projects-btns"),i.setAttribute("data-url",d),i.textContent="Repository",t.appendChild(i),a.addEventListener("click",e),i.addEventListener("click",e))}),l.addEventListener("mouseout",()=>{n.style.opacity="0"})}}isMobile.addEventListener("change",gestisciLayout),isTablet.addEventListener("change",gestisciLayout),isDesktop.addEventListener("change",gestisciLayout),gestisciLayout(),getProjects();let openContactBtn=GetById("openContactBtn"),contactForm=GetById("contactForm"),formStatus=GetById("formStatus"),emailInput=GetById("email");function tornaIndietro(){var e=GetById("contactForm"),t=qs(".body-overlay");t&&t.remove(),e&&e.classList.remove("backdrop-show"),e&&e.parentElement!==document.body&&document.body.appendChild(e)}function showModule(){console.log("showModule chiamata - Inizializzazione step...");let t=ce("div");t.classList.add("body-overlay"),document.body.appendChild(t);var e=GetById("contactForm"),e=(e.classList.add("backdrop-show"),t.insertAdjacentElement("afterend",e),t.addEventListener("click",e=>{e.target===t&&tornaIndietro()}),GetById("tornaIndietroBtn")?.addEventListener("click",tornaIndietro),console.log("Forzo l'inizializzazione degli step..."),STEP_IDS.forEach(e=>{var t=GetById(e);t&&(t.style.display="none",console.log(`Step ${e} nascosto`))}),GetById(STEP_IDS[0]));e&&(e.style.display="block",console.log(`Step ${STEP_IDS[0]} reso visibile`)),showStep(currentStep=0),bindStepButtonsOnce(),setupRealTimeValidation()}openContactBtn?.addEventListener("click",showModule);let STEP_IDS=["initialForm","projectForm","budgetForm","tempisticheForm","commentForm","privacyForm"],currentStep=0;function initializeSteps(){STEP_IDS.forEach((e,t)=>{e=GetById(e);e&&(e.style.display=0===t?"block":"none")})}function showStep(e){console.log("showStep chiamata con indice: "+e),currentStep=Math.max(0,Math.min(e,STEP_IDS.length-1)),console.log("currentStep impostato a: "+currentStep),STEP_IDS.forEach((e,t)=>{var a,i=GetById(e);i?(a=t===currentStep,console.log(`Step ${e} (indice ${t}): `+(a?"VISIBILE":"NASCOSTO")),i.style.display=a?"block":"none"):console.log(`Step ${e} NON TROVATO nel DOM`)});var e=GetById(STEP_IDS[currentStep]),t=GetById("formActions"),e=(e&&t&&e.insertAdjacentElement("afterend",t),GetById("avantiBtn")),t=GetById("submitBtn"),a=STEP_IDS.length-1;currentStep===a?(e&&(e.style.display="none"),t&&(t.style.display="")):(e&&(e.style.display=""),t&&(t.style.display="none"))}function validateCurrentStep(){var e,t=GetById(STEP_IDS[currentStep]);if(t)for(e of t.querySelectorAll("input, select, textarea"))if(!e.checkValidity())return e.reportValidity(),!1;return!0}function bindStepButtonsOnce(){let e=GetById("avantiBtn");var t=GetById("cancelBtn");GetById("contactForm");e&&!e.dataset.bound&&(e.dataset.bound="1",e.addEventListener("click",()=>{"submit"!==e.getAttribute("type")&&validateCurrentStep()&&showStep(currentStep+1)}));let a=STEP_IDS.length-1;t&&!t.dataset.bound&&(t.dataset.bound="1",t.addEventListener("click",e=>{e.preventDefault(),0<currentStep&&currentStep<a?showStep(currentStep-1):(contactForm?.reset(),tornaIndietro())}))}function validateName(e,t=2){e=e.trim();return e?e.length<t?{ok:!1,msg:`Inserisci almeno ${t} caratteri.`}:80<e.length?{ok:!1,msg:"Il campo non pu√≤ superare 80 caratteri."}:{ok:!0,value:e}:{ok:!1,msg:"Il campo √® obbligatorio."}}function validateSelect(e,t=!0){return t&&!e?{ok:!1,msg:"Seleziona una voce."}:{ok:!0,value:e}}function validateMessage(e,t=20){e=e.trim();return e?e.length<t?{ok:!1,msg:`Scrivi almeno ${t} caratteri.`}:2e3<e.length?{ok:!1,msg:"Il messaggio non pu√≤ superare 2000 caratteri."}:{ok:!0,value:e}:{ok:!1,msg:"Il campo √® obbligatorio."}}function validateURL(e){if(!e)return{ok:!0,value:""};e=e.trim();if(!e.startsWith("http://")&&!e.startsWith("https://"))return{ok:!1,msg:"L'URL deve iniziare con http:// o https://"};try{return new URL(e),{ok:!0,value:e}}catch{return{ok:!1,msg:"Inserisci un URL valido."}}}function validateConsent(e){return e?{ok:!0,value:e}:{ok:!1,msg:"Devi accettare per inviare."}}function validateOptionalText(e,t=80){return e?(e=e.trim()).length>t?{ok:!1,msg:`Il campo non pu√≤ superare ${t} caratteri.`}:{ok:!0,value:e}:{ok:!0,value:""}}function validateEmail(e){var t,a,i,e=e.trim().toLowerCase();return e?/\s/.test(e)?{ok:!1,msg:"L‚Äôemail non pu√≤ contenere spazi."}:e.includes("..")?{ok:!1,msg:"L‚Äôemail non pu√≤ contenere due punti consecutivi."}:2!==(t=e.split("@")).length?{ok:!1,msg:"Inserisci un formato valido (es. nome@dominio.it)."}:([t,a]=t,t&&a?t.startsWith(".")||t.endsWith(".")?{ok:!1,msg:"La parte locale non pu√≤ iniziare/finire con un punto."}:a.startsWith("-")||a.endsWith("-")?{ok:!1,msg:"Il dominio non pu√≤ iniziare/finire con un trattino."}:a.includes(".")?!(i=a.split(".").pop())||i.length<2?{ok:!1,msg:"Il TLD deve avere almeno 2 caratteri."}:/^[A-Za-z0-9!#$%&'*+/=?^_`{|}~.-]+$/.test(t)?/^(?:[A-Za-z0-9](?:[A-Za-z0-9-]{0,61}[A-Za-z0-9])?\.)+[A-Za-z]{2,}$/.test(a)?{ok:!0,value:e}:{ok:!1,msg:"Dominio non valido."}:{ok:!1,msg:"Caratteri non validi prima della @."}:{ok:!1,msg:"Il dominio deve contenere un punto."}:{ok:!1,msg:"Manca la parte locale o il dominio."}):{ok:!1,msg:"L‚Äôemail √® obbligatoria."}}function showFieldError(e,t){var a=e.parentElement.querySelector(".error-msg");a&&(a.textContent=t,a.classList.add("show"),e.classList.add("error"))}function hideFieldError(e){var t=e.parentElement.querySelector(".error-msg");t&&(t.classList.remove("show"),e.classList.remove("error"))}function validateField(e,t){t=t(e.value);return t.ok?(hideFieldError(e),!0):(showFieldError(e,t.msg),!1)}function setupRealTimeValidation(){let e=GetById("name"),t=GetById("cognome"),a=(e&&(e.addEventListener("input",()=>validateField(e,validateName)),e.addEventListener("blur",()=>validateField(e,validateName))),t&&(t.addEventListener("input",()=>validateField(t,validateName)),t.addEventListener("blur",()=>validateField(t,validateName))),emailInput&&(emailInput.addEventListener("input",()=>validateField(emailInput,validateEmail)),emailInput.addEventListener("blur",()=>validateField(emailInput,validateEmail))),GetById("company")),i=(a&&(a.addEventListener("input",()=>validateField(a,validateOptionalText)),a.addEventListener("blur",()=>validateField(a,validateOptionalText))),GetById("projectType")),n=GetById("budget"),o=(i&&i.addEventListener("change",()=>validateField(i,validateSelect)),n&&n.addEventListener("change",()=>validateField(n,validateSelect)),GetById("message")),d=(o&&(o.addEventListener("input",()=>validateField(o,validateMessage)),o.addEventListener("blur",()=>validateField(o,validateMessage))),GetById("timeline")),l=(d&&d.addEventListener("change",()=>validateField(d,validateSelect)),GetById("website")),r=(l&&(l.addEventListener("input",()=>validateField(l,validateURL)),l.addEventListener("blur",()=>validateField(l,validateURL))),GetById("consent"));r&&r.addEventListener("change",()=>validateField(r,validateConsent))}function qs(e){return e?document.querySelector(e):null}function qsa(e){return document.querySelectorAll(e)}function ce(e){return document.createElement(e)}function GetById(e){return document.getElementById(e)}contactForm.addEventListener("submit",async t=>{var a=GetById("hp");if(a&&""!==a.value.trim())t.preventDefault();else if(validateCurrentStep()){t.preventDefault(),console.log("Form submit event triggered!");var a=GetById("name"),i=GetById("cognome"),n=GetById("projectType"),o=GetById("budget"),d=GetById("message"),l=GetById("consent");console.log("Fields found:",{nameField:a,cognomeField:i,projectTypeField:n,budgetField:o,messageField:d,consentField:l});let e=!0;a&&!validateField(a,validateName)&&(e=!1),i&&!validateField(i,validateName)&&(e=!1),emailInput&&!validateField(emailInput,validateEmail)&&(e=!1);a=GetById("company"),i=(a&&!validateField(a,validateOptionalText)&&(e=!1),n&&!validateField(n,validateSelect)&&(e=!1),o&&!validateField(o,validateSelect)&&(e=!1),GetById("timeline")),a=(i&&!validateField(i,validateSelect)&&(e=!1),d&&!validateField(d,validateMessage)&&(e=!1),l&&!validateField(l,validateConsent)&&(e=!1),GetById("website"));if(e=a&&!validateField(a,validateURL)?!1:e){console.log("Form validation passed, sending data...");n=new FormData(contactForm);try{console.log("Sending data to Formspree...");var r=await fetch("https://formspree.io/f/xgvzqkbe",{method:"POST",body:n,headers:{Accept:"application/json"}});console.log("Response received:",r),r.ok?(formStatus&&(formStatus.textContent="Richiesta inviata con successo! üéâ",formStatus.classList.add("form-status"),qs("#privacyForm").remove()),GetById("avantiBtn")?.setAttribute("disabled","disabled"),GetById("submitBtn")?.setAttribute("disabled","disabled"),GetById("cancelBtn")?.setAttribute("disabled","disabled"),setTimeout(()=>{contactForm.reset(),showStep(0),tornaIndietro(),GetById("avantiBtn")?.removeAttribute("disabled"),GetById("submitBtn")?.removeAttribute("disabled"),GetById("cancelBtn")?.removeAttribute("disabled"),formStatus&&(formStatus.textContent="")},3e3)):formStatus&&(formStatus.textContent="Errore durante l‚Äôinvio. Riprova.",formStatus.style.color="#dc3545")}catch(e){console.error(e),formStatus.textContent="Errore di connessione. Verifica la tua connessione.",formStatus.style.color="#dc3545"}}else console.log("Form validation failed!")}else t.preventDefault()}),document.addEventListener("DOMContentLoaded",initializeSteps);export{qs,qsa,ce,GetById};